{
  "hash": "356126da5282315ed6d5897a3e5a3c3d",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"LS 빅데이터 스쿨 Homework 8\"\nauthor: \"이예솔\"\ndate: \"2024-09-10\"\ncategories: [bigdata]\n---\n\n\n# 변수설명\n- 종속변수: 백혈병 세포 관측 불가 여부 (REMISS), 1이면 관측 안됨을 의미\n- 독립변수:\n- 골수의 세포성 (CELL)\n- 골수편의 백혈구 비율 (SMEAR)\n- 골수의 백혈병 세포 침투 비율 (INFIL)\n- 골수 백혈병 세포의 라벨링 인덱스 (LI)\n- 말초혈액의 백혈병 세포 수 (BLAST)\n- 치료 시작 전 최고 체온 (TEMP)\n\n# 문제 1. 데이터를 로드하고, 로지스틱 회귀모델을 적합하고, 회귀 표를 작성하세요.\n\n::: {#9a4ae9e8 .cell execution_count=1}\n``` {.python .cell-code}\nimport pandas as pd\nimport statsmodels.api as sm\n\ndf = pd.read_csv('leukemia_remission.txt', delim_whitespace=True)\ndf\nmodel = sm.formula.logit(\"REMISS ~ CELL + SMEAR + INFIL + LI + BLAST + TEMP\", data=df).fit()\nmodel.summary()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nOptimization terminated successfully.\n         Current function value: 0.399886\n         Iterations 10\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nC:\\Users\\USER\\AppData\\Local\\Temp\\ipykernel_19092\\2914014757.py:4: FutureWarning:\n\nThe 'delim_whitespace' keyword in pd.read_csv is deprecated and will be removed in a future version. Use ``sep='\\s+'`` instead\n\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=1}\n```{=html}\n<table class=\"simpletable\">\n<caption>Logit Regression Results</caption>\n<tr>\n  <th>Dep. Variable:</th>        <td>REMISS</td>      <th>  No. Observations:  </th>  <td>    27</td> \n</tr>\n<tr>\n  <th>Model:</th>                 <td>Logit</td>      <th>  Df Residuals:      </th>  <td>    20</td> \n</tr>\n<tr>\n  <th>Method:</th>                 <td>MLE</td>       <th>  Df Model:          </th>  <td>     6</td> \n</tr>\n<tr>\n  <th>Date:</th>            <td>Tue, 10 Sep 2024</td> <th>  Pseudo R-squ.:     </th>  <td>0.3718</td> \n</tr>\n<tr>\n  <th>Time:</th>                <td>10:41:38</td>     <th>  Log-Likelihood:    </th> <td> -10.797</td>\n</tr>\n<tr>\n  <th>converged:</th>             <td>True</td>       <th>  LL-Null:           </th> <td> -17.186</td>\n</tr>\n<tr>\n  <th>Covariance Type:</th>     <td>nonrobust</td>    <th>  LLR p-value:       </th>  <td>0.04670</td>\n</tr>\n</table>\n<table class=\"simpletable\">\n<tr>\n      <td></td>         <th>coef</th>     <th>std err</th>      <th>z</th>      <th>P>|z|</th>  <th>[0.025</th>    <th>0.975]</th>  \n</tr>\n<tr>\n  <th>Intercept</th> <td>   64.2581</td> <td>   74.965</td> <td>    0.857</td> <td> 0.391</td> <td>  -82.670</td> <td>  211.187</td>\n</tr>\n<tr>\n  <th>CELL</th>      <td>   30.8301</td> <td>   52.135</td> <td>    0.591</td> <td> 0.554</td> <td>  -71.353</td> <td>  133.013</td>\n</tr>\n<tr>\n  <th>SMEAR</th>     <td>   24.6863</td> <td>   61.526</td> <td>    0.401</td> <td> 0.688</td> <td>  -95.903</td> <td>  145.275</td>\n</tr>\n<tr>\n  <th>INFIL</th>     <td>  -24.9745</td> <td>   65.281</td> <td>   -0.383</td> <td> 0.702</td> <td> -152.923</td> <td>  102.974</td>\n</tr>\n<tr>\n  <th>LI</th>        <td>    4.3605</td> <td>    2.658</td> <td>    1.641</td> <td> 0.101</td> <td>   -0.849</td> <td>    9.570</td>\n</tr>\n<tr>\n  <th>BLAST</th>     <td>   -0.0115</td> <td>    2.266</td> <td>   -0.005</td> <td> 0.996</td> <td>   -4.453</td> <td>    4.430</td>\n</tr>\n<tr>\n  <th>TEMP</th>      <td> -100.1734</td> <td>   77.753</td> <td>   -1.288</td> <td> 0.198</td> <td> -252.567</td> <td>   52.220</td>\n</tr>\n</table><br/><br/>Possibly complete quasi-separation: A fraction 0.11 of observations can be<br/>perfectly predicted. This might indicate that there is complete<br/>quasi-separation. In this case some parameters will not be identified.\n```\n:::\n:::\n\n\n# 문제 2. 해당 모델은 통계적으로 유의한가요? 그 이유를 검정통계량를 사용해서 설명하시오.\n- LLR p-value:0.04670로 0.05보다 작으므로 모델이 통계적으로 유의하다.\n- 귀무가설:통계적으로 유의하지 않다, 0.05이하 이므로 귀무가설 기각\n\n# 문제 3. 유의수준이 0.2일떄 통계적으로 유의한 변수는 몇개이며, 어느 변수 인가요?\n- P>|z|가 0.2보다 작은 LI, TEMP가 유의하다\n\n# 문제 4. 다음 환자에 대한 오즈는 얼마인가요?\n- CELL (골수의 세포성): 65%\n- SMEAR (골수편의 백혈구 비율): 45%\n- INFIL (골수의 백혈병 세포 침투 비율): 55%\n- LI (골수 백혈병 세포의 라벨링 인덱스): 1.2\n- BLAST (말초혈액의 백혈병 세포 수): 1.1 세포/μL\n- TEMP (치료 시작 전 최고 체온): 0.9\n\n::: {#f10f1fd2 .cell execution_count=2}\n``` {.python .cell-code}\nimport numpy as np\nodds = np.exp(64.2581+ 0.65*30.8301+0.45*24.6863+0.55*-24.9745+1.2*4.3605+1.1*-0.0115+0.9*-100.1734)\nodds # 0.03817459641135519\n```\n\n::: {.cell-output .cell-output-display execution_count=2}\n```\nnp.float64(0.03817459641135519)\n```\n:::\n:::\n\n\n# 문제 5. 위 환자의 혈액에서 백혈병 세포가 관측되지 않은 확률은 얼마인가요?\n\n::: {#b983023a .cell execution_count=3}\n``` {.python .cell-code}\np_hat = odds/(odds+1)\np_hat\n```\n\n::: {.cell-output .cell-output-display execution_count=3}\n```\nnp.float64(0.03677088280074742)\n```\n:::\n:::\n\n\n# 문제 6. TEMP 변수의 계수는 얼마이며, 해당 계수를 사용해서 TEMP 변수가 백혈병 치료에 대한 영향을 설명하시오.\n\n::: {#8d07b500 .cell execution_count=4}\n``` {.python .cell-code}\n# TEMP 변수의 계수: -100.1734\nround(np.exp(-100.1734),4) # 0\n# 지수 값이 거의 0에 가까우므로, TEMP가 증가할수록 백혈병 치료 성공 가능성(REMISS = 1)이 급격히 감소한다. 즉, 백혈병 치료에 대한 음의 영향을 미친다.\n```\n\n::: {.cell-output .cell-output-display execution_count=4}\n```\nnp.float64(0.0)\n```\n:::\n:::\n\n\n# 문제 7. CELL 변수의 99% 오즈비에 대한 신뢰구간을 구하시오.\n\n::: {#48137728 .cell execution_count=5}\n``` {.python .cell-code}\nfrom scipy.stats import norm\nz005 = norm.ppf(0.995) \nz005 # 2.5758293035489004\n30.8301 - z005 * 52.135  # -103.4607607405219\n30.8301 + z005 * 52.135  # 165.12096074052192\n```\n\n::: {.cell-output .cell-output-display execution_count=5}\n```\nnp.float64(165.12096074052192)\n```\n:::\n:::\n\n\n# 문제 8. 주어진 데이터에 대하여 로지스틱 회귀 모델의 예측 확률을 구한 후, 50% 이상인 경우 1로 처리하여, 혼동 행렬를 구하시오.\n\n::: {#8025cd30 .cell execution_count=6}\n``` {.python .cell-code}\n# pred_y, y_hat 파생변수 구하기\nx = df.drop(['REMISS'], axis=1)\ndf['pred_y'] = round(model.predict(x),4)\ndf['y_hat'] = np.where(df['pred_y']>=0.5,1,0)\ndf\n```\n\n::: {.cell-output .cell-output-display execution_count=6}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>REMISS</th>\n      <th>CELL</th>\n      <th>SMEAR</th>\n      <th>INFIL</th>\n      <th>LI</th>\n      <th>BLAST</th>\n      <th>TEMP</th>\n      <th>pred_y</th>\n      <th>y_hat</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>1</td>\n      <td>0.80</td>\n      <td>0.83</td>\n      <td>0.66</td>\n      <td>1.9</td>\n      <td>1.10</td>\n      <td>1.00</td>\n      <td>0.7364</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>1</td>\n      <td>0.90</td>\n      <td>0.36</td>\n      <td>0.32</td>\n      <td>1.4</td>\n      <td>0.74</td>\n      <td>0.99</td>\n      <td>0.4563</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>0</td>\n      <td>0.80</td>\n      <td>0.88</td>\n      <td>0.70</td>\n      <td>0.8</td>\n      <td>0.18</td>\n      <td>0.98</td>\n      <td>0.1795</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>0</td>\n      <td>1.00</td>\n      <td>0.87</td>\n      <td>0.87</td>\n      <td>0.7</td>\n      <td>1.05</td>\n      <td>0.99</td>\n      <td>0.2152</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>1</td>\n      <td>0.90</td>\n      <td>0.75</td>\n      <td>0.68</td>\n      <td>1.3</td>\n      <td>0.52</td>\n      <td>0.98</td>\n      <td>0.7369</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>0</td>\n      <td>1.00</td>\n      <td>0.65</td>\n      <td>0.65</td>\n      <td>0.6</td>\n      <td>0.52</td>\n      <td>0.98</td>\n      <td>0.3410</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>1</td>\n      <td>0.95</td>\n      <td>0.97</td>\n      <td>0.92</td>\n      <td>1.0</td>\n      <td>1.23</td>\n      <td>0.99</td>\n      <td>0.4232</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>0</td>\n      <td>0.95</td>\n      <td>0.87</td>\n      <td>0.83</td>\n      <td>1.9</td>\n      <td>1.35</td>\n      <td>1.02</td>\n      <td>0.5956</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <td>0</td>\n      <td>1.00</td>\n      <td>0.45</td>\n      <td>0.45</td>\n      <td>0.8</td>\n      <td>0.32</td>\n      <td>1.00</td>\n      <td>0.1506</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>9</th>\n      <td>0</td>\n      <td>0.95</td>\n      <td>0.36</td>\n      <td>0.34</td>\n      <td>0.5</td>\n      <td>0.00</td>\n      <td>1.04</td>\n      <td>0.0003</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>10</th>\n      <td>0</td>\n      <td>0.85</td>\n      <td>0.39</td>\n      <td>0.33</td>\n      <td>0.7</td>\n      <td>0.28</td>\n      <td>0.99</td>\n      <td>0.0138</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>11</th>\n      <td>0</td>\n      <td>0.70</td>\n      <td>0.76</td>\n      <td>0.53</td>\n      <td>1.2</td>\n      <td>0.15</td>\n      <td>0.98</td>\n      <td>0.1715</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>12</th>\n      <td>0</td>\n      <td>0.80</td>\n      <td>0.46</td>\n      <td>0.37</td>\n      <td>0.4</td>\n      <td>0.38</td>\n      <td>1.01</td>\n      <td>0.0002</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>13</th>\n      <td>0</td>\n      <td>0.20</td>\n      <td>0.39</td>\n      <td>0.08</td>\n      <td>0.8</td>\n      <td>0.11</td>\n      <td>0.99</td>\n      <td>0.0000</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>14</th>\n      <td>0</td>\n      <td>1.00</td>\n      <td>0.90</td>\n      <td>0.90</td>\n      <td>1.1</td>\n      <td>1.04</td>\n      <td>0.99</td>\n      <td>0.6087</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>15</th>\n      <td>1</td>\n      <td>1.00</td>\n      <td>0.84</td>\n      <td>0.84</td>\n      <td>1.9</td>\n      <td>2.06</td>\n      <td>1.02</td>\n      <td>0.7171</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>16</th>\n      <td>0</td>\n      <td>0.65</td>\n      <td>0.42</td>\n      <td>0.27</td>\n      <td>0.5</td>\n      <td>0.11</td>\n      <td>1.01</td>\n      <td>0.0000</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>17</th>\n      <td>0</td>\n      <td>1.00</td>\n      <td>0.75</td>\n      <td>0.75</td>\n      <td>1.0</td>\n      <td>1.32</td>\n      <td>1.00</td>\n      <td>0.2777</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>18</th>\n      <td>0</td>\n      <td>0.50</td>\n      <td>0.44</td>\n      <td>0.22</td>\n      <td>0.6</td>\n      <td>0.11</td>\n      <td>0.99</td>\n      <td>0.0000</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>19</th>\n      <td>1</td>\n      <td>1.00</td>\n      <td>0.63</td>\n      <td>0.63</td>\n      <td>1.1</td>\n      <td>1.07</td>\n      <td>0.99</td>\n      <td>0.6269</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>20</th>\n      <td>0</td>\n      <td>1.00</td>\n      <td>0.33</td>\n      <td>0.33</td>\n      <td>0.4</td>\n      <td>0.18</td>\n      <td>1.01</td>\n      <td>0.0117</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>21</th>\n      <td>0</td>\n      <td>0.90</td>\n      <td>0.93</td>\n      <td>0.84</td>\n      <td>0.6</td>\n      <td>1.59</td>\n      <td>1.02</td>\n      <td>0.0037</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>22</th>\n      <td>1</td>\n      <td>1.00</td>\n      <td>0.58</td>\n      <td>0.58</td>\n      <td>1.0</td>\n      <td>0.53</td>\n      <td>1.00</td>\n      <td>0.2895</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>23</th>\n      <td>0</td>\n      <td>0.95</td>\n      <td>0.32</td>\n      <td>0.30</td>\n      <td>1.6</td>\n      <td>0.89</td>\n      <td>0.99</td>\n      <td>0.8518</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>24</th>\n      <td>1</td>\n      <td>1.00</td>\n      <td>0.60</td>\n      <td>0.60</td>\n      <td>1.7</td>\n      <td>0.96</td>\n      <td>0.99</td>\n      <td>0.9587</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>25</th>\n      <td>1</td>\n      <td>1.00</td>\n      <td>0.69</td>\n      <td>0.69</td>\n      <td>0.9</td>\n      <td>0.40</td>\n      <td>0.99</td>\n      <td>0.4103</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>26</th>\n      <td>0</td>\n      <td>1.00</td>\n      <td>0.73</td>\n      <td>0.73</td>\n      <td>0.7</td>\n      <td>0.40</td>\n      <td>0.99</td>\n      <td>0.2234</td>\n      <td>0</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {#05642823 .cell execution_count=7}\n``` {.python .cell-code}\n# 혼동행렬 만들기\nfrom sklearn.metrics import confusion_matrix\n\nconf_mat=confusion_matrix(y_true=df['REMISS'], \n                          y_pred=df['y_hat'],\n                          labels=[1, 0])\nconf_mat\n```\n\n::: {.cell-output .cell-output-display execution_count=7}\n```\narray([[ 5,  4],\n       [ 3, 15]])\n```\n:::\n:::\n\n\n::: {#bb45adf8 .cell execution_count=8}\n``` {.python .cell-code}\n# 혼동행렬 보이기\nfrom sklearn.metrics import ConfusionMatrixDisplay\n\np=ConfusionMatrixDisplay(confusion_matrix=conf_mat,\n                         display_labels=(\"1\", \"0\"))\np.plot(cmap=\"Blues\")\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-9-output-1.png){width=496 height=429}\n:::\n:::\n\n\n# 문제 9. 해당 모델의 Accuracy는 얼마인가요?\n\n::: {#0266f59a .cell execution_count=9}\n``` {.python .cell-code}\nAccuracy = (5+15)/len(df) \nAccuracy # 0.7407407407407407\n```\n\n::: {.cell-output .cell-output-display execution_count=9}\n```\n0.7407407407407407\n```\n:::\n:::\n\n\n# 문제 10. 해당 모델의 F1 Score를 구하세요.\n\n::: {#dfd56ee5 .cell execution_count=10}\n``` {.python .cell-code}\nPrecision = 5/(5+3) # 0.625\nRecall = 5/(5+4) # 0.5555555555555556\nF1_score = 2*Precision*Recall/(Precision+Recall)\nF1_score # 0.5882352941176471\n```\n\n::: {.cell-output .cell-output-display execution_count=10}\n```\n0.5882352941176471\n```\n:::\n:::\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}